@model TravelExpress.Models.Booking

@{
	ViewBag.Title = "Create Booking";
}


<h2> Create Booking </h2>


<form asp-action="Create" method="post">
	<input type="hidden" asp-for="RoomId" />
	<input type="hidden" asp-for="HotelId"/>

	<div class="form-group">
		<label asp-for="checkIn"></label>
		<input asp-for="checkIn" id="checkIn" class="form-control" type="date" />
		<span asp-validation-for="checkIn" class="text-danger"></span>
	</div>

	<div class="form-group">
		<label asp-for="checkOut"></label>
		<input asp-for="checkOut" id="checkOut" class="form-control" type="date" />
		<span asp-validation-for="checkOut" class="text-danger"></span>
	</div>

	
	<div id="availabiltyStatus" class="mt-2 text-info"></div>

<button type="submit" class="btn btn-primary"> Book Now </button>
<a asp-action="Details" asp-controller="Room" asp-route-id="@Model.RoomId" class="btn btn-secondary"> Cancel </a>
</form>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const checkInInput = document.getElementById('checkIn');
            const checkOutInput = document.getElementById('checkOut');
            const statusDiv = document.getElementById('availabiltyStatus');
            const roomId = '@Model.RoomId';

            function areBothDatesFilled() {
                return checkInInput.value && checkOutInput.value;
            }

            async function checkAvailability() {
                if (!areBothDatesFilled()) {
                    statusDiv.textContent = '';
                    return;
                }

                const checkIn = checkInInput.value;
                const checkOut = checkOutInput.value;

                try {
                    const response = await fetch(`/Booking/CheckAvailability?roomId=${roomId}&checkIn=${checkIn}&checkOut=${checkOut}`);
                    const data = await response.json();

                    if (!data.available) {
                        statusDiv.textContent = 'Booked';
                        statusDiv.style.color = 'red';
                    } else {
                        statusDiv.textContent = '';
                    }
                } catch (error) {
                    console.error('Error checking availability:', error);
                    statusDiv.textContent = '';
                }
            }

            checkInInput.addEventListener('change', checkAvailability);
            checkOutInput.addEventListener('change', checkAvailability);
        });
    </script>
}
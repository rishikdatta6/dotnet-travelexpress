@model TravelExpress.Models.Hotel

@{
    ViewData["Title"] = "Search Available Rooms";
}

<div class="container mt-4">
    <h2>Check Room Availability in <span class="text-primary">@Model.Name</span></h2>

    <div class="alert alert-danger d-none" id="dateError"></div> <!-- Validation Message -->

    <form id="roomSearchForm" asp-controller="Room" asp-action="UserRoomDetails" method="get" class="mt-4">
        <input type="hidden" name="hotelId" value="@Model.HotelId" />

        <div class="row mb-3">
            <div class="col-md-4">
                <label>Check-In Date</label>
                <input type="date" name="checkIn" id="checkIn" class="form-control" required min="@DateTime.Today.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-4">
                <label>Check-Out Date</label>
                <input type="date" name="checkOut" id="checkOut" class="form-control" required min="@DateTime.Today.AddDays(1).ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-4 align-self-end">
                <button type="submit" class="btn btn-success">Search Available Rooms</button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.getElementById("roomSearchForm").addEventListener("submit", function (e) {
            var checkIn = new Date(document.getElementById("checkIn").value);
            var checkOut = new Date(document.getElementById("checkOut").value);
            var today = new Date();
            today.setHours(0, 0, 0, 0); // Clear time portion

            var errorBox = document.getElementById("dateError");
            errorBox.classList.add("d-none");
            errorBox.innerText = "";

            if (checkIn < today || checkOut <= today) {
                e.preventDefault();
                errorBox.innerText = "Check-in and Check-out dates must be in the future.";
                errorBox.classList.remove("d-none");
                return;
            }

            if (checkIn >= checkOut) {
                e.preventDefault();
                errorBox.innerText = "Check-out date must be after check-in date.";
                errorBox.classList.remove("d-none");
            }
        });
    </script>
}
